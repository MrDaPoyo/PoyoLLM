<!DOCTYPE html>
<html>
    <head>
        <title>PoyoSLM Demo</title>
        <style>
            .spinner {
                border: 4px solid rgba(0, 0, 0, 0.1);
                width: 1vh;
                height: 1vh;
                border-radius: 50%;
                border-left-color: blue;
                animation: spin 1s linear infinite;
                display: inline-block;
                vertical-align: middle;
            }
            #result {
                margin-top: 20px;
                white-space: pre-wrap;
                word-wrap: break-word;
                text-wrap: break-word;
            }
            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }
        </style>
        <script>
            async function fetchResponse() {
                const button = document.getElementById("generateButton");
                const spinner = document.getElementById("spinner");
                const result = document.getElementById("result");
                button.disabled = true; // lock the button
                spinner.style.display = "inline-block"; // show spinner
                result.innerText = "";
                const prompt = document.getElementById("prompt").value;
                try {
                    const response = await fetch("/generate", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ prompt: prompt }),
                    });
                    if (!response.ok) {
                        result.innerText = "Error: " + await response.text();
                    } else {
                        const reader = response.body.getReader();
                        const decoder = new TextDecoder();
                        let done = false;
                        while (!done) {
                            const { value, done: doneReading } = await reader.read();
                            done = doneReading;
                            if (value) {
                                const chunk = decoder.decode(value);
                                result.innerText += chunk;
                            }
                        }
                    }
                } catch (error) {
                    result.innerText = "Fetch error: " + error;
                }
                spinner.style.display = "none"; // hide spinner
                button.disabled = false; // unlock the button
            }
        </script>
    </head>
    <body>
        <h1>Generate Response</h1>
        <textarea
            id="prompt"
            rows="4"
            cols="50"
            placeholder="Enter your prompt here"
        ></textarea><br />
        <button id="generateButton" onclick="fetchResponse()">Generate</button>
        <div id="spinner" class="spinner" style="display: none"></div>
        <h2>Response:</h2>
        <pre id="result"></pre>
    </body>
</html>
